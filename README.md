# abb_test_task
Тестовое задание на позицию "Стажер — разработчик BI, ETL и DQ"

1. Имеется 3 таблицы:
Таблица: FCT_IDV_LBY_AR – таблица фактов(показателей) по договорам. Показатель рассчитывается за каждый день.
Таблица: DIM_IDV_LBY_AR – таблица атрибутов по договорам. Новая строка по договору добавляется в таблицу только в случае если меняется какой-либо атрибут.
Таблица: DIM_IDV_PD – справочник продуктов

Задача: Необходимо построить SQL-запрос, который выводит на дату (любую конкретную дату, которую можно менять и запрос будет работать корректно)  по каждому клиенту суммарный остаток по договорам конкретного продукта и средняя ставку по этому продукту. (например, это могут быть суммарные остатки по всем депозитам на дату, или суммарные остатки по всем картам клиентов на дату и т.д.)

2. Вводные данные: Имеется таблица показателей (далее регистров) по депозитным договорам, со следующим набором столбцов: Таблица: GD_TD_REG
Столбец DEP_REG_ID может иметь следующие значения:
«DP001» - оборотный регистр зачисления средств по договору (пополнение вклада)
«DP005» - регистр остаток средств по договору (сумма вклада, остаток по договору)
«DP004» - оборотный регистр частичного снятия средств по договору со вклада
«DP014» - оборотный регистр полного снятия средств по договору со вклада в случае досрочного расторжения.
Регистр по остатку формируется за дату (ACT_DT) только в случае если он изменился по отношению к предыдущему состоянию. Оборотный регистр формируется за дату (ACT_DT) только в случае если по данному регистру был оборот. 
Соответственно, на каждую дату актуальности ACT_DT мы имеем только тот набор строк с договорами и регистрами по ним, которые менялись или имели ненулевой оборот.

Задача: Необходимо построить SQL-запрос, который будет выводить на дату (любую конкретную дату, которую можно менять и запрос будет работать корректно) по каждому договору: 
1) Остаток по договору
2) Сумму зачислений за предыдущие 30 дней
3)  Сумму полных снятий при досрочном расторжении и частичных снятий за предыдущие 30 дней.

3. Вводные данные: Имеются 5 таблиц:
Таблица: DIM_ORG – таблица клиентов ЮЛ. Новая запись по клиенту добавляется в таблицу только в случае если меняется какой-либо атрибут.
Таблица: DIM_ORG_LBY_AR – таблица депозитных сделок ЮЛ. Новая запись по клиенту добавляется в таблицу только в случае если меняется какой-либо атрибут.
Таблица: DIM_ORG_LOAN_AR – таблица кредитных сделок ЮЛ. Новая запись по клиенту добавляется в таблицу только в случае если меняется какой-либо атрибут.
Таблица: DIM_ORG_GNT_AR – таблица сделок гарантий ЮЛ. Новая запись по клиенту добавляется в таблицу только в случае если меняется какой-либо атрибут.
Таблица: PST_ENTR – таблица проводок по счетам (в случае проводок по пассивным счетам проводка по дебету счета расходная операция – расход средств со счета, по кредиту счета приходная операция – поступление средств насчет).
Столбец END_DT заполняется значением «2999-12-31» до тех пор, пока сделка открыта. Когда сделка закрывается появляется новая запись где проставляется фактическая дата закрытия.
Все таблицы имеют одинаковый механизм историзации – та или иная запись с некоторым набором атрибутов актуальна с DIM_EFF_DT до DIM_END_DT.
Даты действия записей в разных таблицах никак не связаны между собой и имеют отношение только к объекту, который хранит конкретная таблица.

Задача 1: Необходимо построить SQL-запрос, который будет выводить по каждому клиенту за определенную дату следующую информацию.
Задача 2: Необходимо построить SQL-запрос, который будет выводить статистику по кол-ву клиентов и сделок в разрезе продуктов за определенную дату.

4. Предложить вариант хранения перечисленных ниже сущностей, пояснить целесообразность выбранного решения:
1) Схематически изобразить ER-модель получившейся базы данных. Изобразить схему в любой из программ для моделирования.
2) Предложить реализацию (ER модель) витрин по следующим бизнес-требованиям:
3) Перечислить какие по вашему мнению возможны ошибки в данных и какие возможно реализовать проверки для их предотвращения?
